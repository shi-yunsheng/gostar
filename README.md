# GoStar

GoStar æ˜¯ä¸€ä¸ªè½»é‡çº§ã€åŠŸèƒ½å®Œå–„çš„ Go Web æ¡†æž¶ï¼Œæä¾›ç®€æ˜Žå‹å¥½çš„ APIï¼Œå¸®åŠ©ä½ åœ¨æœ€çŸ­æ—¶é—´å†…æ­å»ºç”Ÿäº§å¯ç”¨çš„ Web æœåŠ¡ã€‚

## ç‰¹æ€§æ¦‚è§ˆ
- ðŸš€ **å¿«é€Ÿä¸Šæ‰‹**ï¼šç›´è§‚çš„ API è®¾è®¡ä¸Žåˆç†çš„é»˜è®¤å€¼ï¼Œå‡ åˆ†é’Ÿå³å¯è·‘é€šé¡¹ç›®ã€‚ 
- ðŸ›£ï¸ **çµæ´»è·¯ç”±**ï¼šæ”¯æŒåµŒå¥—è·¯ç”±ã€æ­£åˆ™è·¯ç”±ã€å¯é€‰è·¯å¾„å‚æ•°ä¸Žè·¯ç”±çº§ä¸­é—´ä»¶ã€‚ 
- ðŸ”Œ **ä¸­é—´ä»¶ä½“ç³»**ï¼šå†…ç½®é”™è¯¯æ¢å¤ã€è®¿é—®æ—¥å¿—ã€CORSã€é€ŸçŽ‡é™åˆ¶ç­‰å¸¸ç”¨ä¸­é—´ä»¶ï¼Œå¯æŒ‰éœ€æ‹“å±•ã€‚ 
- ðŸ“¡ **è‡ªåŠ¨å“åº”**ï¼šå¤„ç†å™¨ç›´æŽ¥è¿”å›ž `any`ï¼Œæ¡†æž¶è‡ªåŠ¨å°è£…ä¸º JSONï¼›è‹¥å·²æ‰‹åŠ¨å†™å…¥å“åº”ä½“åˆ™ä¸ä¼šé‡å¤è¾“å‡ºã€‚ 
- ðŸŒ **é™æ€ & SPA & WebSocket**ï¼šåŒä¸€å¥—è·¯ç”±ä½“ç³»å³å¯æ‰¿è½½é™æ€èµ„æºã€å•é¡µåº”ç”¨ä»¥åŠ WebSocket å®žæ—¶é€šä¿¡ã€‚ 
- ðŸ’¾ **æ•°æ®æŽ¥å…¥**ï¼šåŽŸç”Ÿæ”¯æŒ MySQLã€PostgreSQLã€SQLiteã€MongoDB ä¸Ž Redisï¼Œæä¾›ç»Ÿä¸€çš„åˆå§‹åŒ–æµç¨‹ã€‚ 
- ðŸªµ **æ—¥å¿—ç³»ç»Ÿ**ï¼šå½©è‰²æŽ§åˆ¶å°è¾“å‡ºã€æ–‡ä»¶ä¿å­˜ã€è‡ªåŠ¨å½’æ¡£ä¸Žæ¸…ç†ï¼Œæ»¡è¶³å¼€å‘åˆ°ç”Ÿäº§çš„æ—¥å¿—éœ€æ±‚ã€‚ 
- âš™ï¸ **é…ç½®ä¸­å¿ƒ**ï¼šå†…ç½® YAML é…ç½®è§£æžï¼Œé¦–æ¬¡å¯åŠ¨è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶ã€‚ 
- âš¡ **ç¨³å®šé«˜æ•ˆ**ï¼šåŸºäºŽæ ‡å‡†åº“ `net/http` æž„å»ºï¼Œæ ¸å¿ƒå®žçŽ°ç®€æ´å¯é ã€‚ 

## å®‰è£…
```bash
go get -u github.com/shi-yunsheng/gostar@v1.0.48-beta
```

## å¿«é€Ÿå¼€å§‹
```go
package main

import (
    "fmt"

    "github.com/shi-yunsheng/gostar"
    "github.com/shi-yunsheng/gostar/logger"
    "github.com/shi-yunsheng/gostar/router"
    "github.com/shi-yunsheng/gostar/router/handler"
)

func main() {
    app := gostar.New()

    app.UseRouter([]router.Route{
        {
            Method: router.GET,
            Path:   "/ping",
            Handler: func(w *handler.Response, r handler.Request) any {
                return map[string]string{"message": "pong"}
            },
        },
        {
            Method: router.GET,
            Path:   "/hello/{name?:str}",
            Handler: func(w *handler.Response, r handler.Request) any {
                name, _ := r.GetParam("name").(string)
                if name == "" {
                    name = "gostar"
                }
                return map[string]string{
                    "greeting": fmt.Sprintf("Hello %s", name),
                }
            },
        },
        {
            Method: router.GET,
            Path:   "/error",
            Handler: func(w *handler.Response, r handler.Request) any {
                panic("demo error")
            },
        },
    })

    if err := app.Run(); err != nil {
        logger.E("failed to run server: %v", err)
    }
}
```

## æ¡†æž¶èƒ½åŠ›
### è·¯ç”±ç³»ç»Ÿ
- æ”¯æŒé™æ€è·¯ç”±ã€æ­£åˆ™è·¯ç”±ã€è·¯å¾„å‚æ•°ï¼ˆå«å¯é€‰å‚æ•°ä¸Žé»˜è®¤å€¼ï¼‰ä»¥åŠå¤šçº§åµŒå¥—ã€‚
- è·¯ç”±èŠ‚ç‚¹å¯å•ç‹¬æŒ‡å®šä¸­é—´ä»¶ã€é™æ€èµ„æºæ‰˜ç®¡ã€WebApp é¢„å¤„ç†æˆ– WebSocket å‡çº§é…ç½®ã€‚
- å†…ç½®å¤šè¯­è¨€è·¯å¾„å‚æ•°æ ¡éªŒï¼Œè‡ªåŠ¨å°†åŒ¹é…ç»“æžœå†™å…¥ `handler.Request` ä¾›å¤„ç†å™¨è¯»å–ã€‚

### ä¸­é—´ä»¶
- æ¡†æž¶é»˜è®¤å¯ç”¨é”™è¯¯æ¢å¤ã€è¯·æ±‚æ—¥å¿—ã€CORS ä¸‰ä¸ªå…¨å±€ä¸­é—´ä»¶ã€‚
- é€šè¿‡ `UseMiddleware` ä¸Žè·¯ç”±çº§ `Middleware` å­—æ®µå³å¯å®žçŽ°â€œæ´‹è‘±æ¨¡åž‹â€å¤„ç†é“¾ã€‚
- å®˜æ–¹æä¾›çš„ `middleware.RateLimitMiddleware` å¯å¿«é€Ÿå®žçŽ° IP + è·¯å¾„ç²’åº¦çš„é™æµä¿æŠ¤ã€‚

### è¯·æ±‚ / å“åº”å¤„ç†
- å¤„ç†å™¨ç­¾åï¼š`type Handler func(w *Response, r Request) any`ã€‚
- è‹¥å¤„ç†å™¨æœªå†™å…¥å“åº”ä½“ï¼Œè¿”å›žå€¼ä¼šè¢«è‡ªåŠ¨åºåˆ—åŒ–ä¸º JSONã€‚
- å†…ç½® `Response` å¯¹è±¡å¯æ–¹ä¾¿åœ°å†™å…¥ JSON / HTML / Textã€ç®¡ç†å“åº”å¤´ã€èŽ·å– WebSocket è¿žæŽ¥ç­‰ã€‚
- é€šè¿‡ `Request` å¯¹è±¡å³å¯è®¿é—®è·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“ã€ä¸Šä¼ æ–‡ä»¶ä»¥åŠ WebSocket çŠ¶æ€ã€‚

### é™æ€èµ„æºã€WebApp ä¸Ž WebSocket
- `handler.StaticServer` æ”¯æŒé™é€Ÿä¸‹è½½ã€ç±»åž‹ç™½åå•ã€ä¸Šä¼ ç›®å½•ä¸Žå›žè°ƒç­‰é«˜çº§èƒ½åŠ›ã€‚
- `handler.WebApp` å¯ä¸º SPA è‡ªåŠ¨å…œåº•æœªå‘½ä¸­çš„å­è·¯å¾„ï¼Œå¤©ç„¶æ”¯æŒ History / Hash æ¨¡å¼ã€‚
- `handler.ToWebsocketHandler` ç®€åŒ– WebSocket å‡çº§æµç¨‹ï¼Œæä¾›çº¿ç¨‹å®‰å…¨çš„æ¶ˆæ¯è¯»å†™å°è£…ã€‚

### æ•°æ®ä¸Žé…ç½®
- `model` æ¨¡å—æä¾›æ•°æ®åº“åˆå§‹åŒ–ã€CRUD æ‰©å±•ã€åˆ†é¡µã€å…³è”æŸ¥è¯¢ç­‰èƒ½åŠ›ï¼Œå…¼å®¹ GORM ä¸Ž MongoDBã€‚
- `model.InitRedis` æ”¯æŒå¤šå®žä¾‹é…ç½®ï¼Œå†…ç½®å¸¸è§çš„è¿žæŽ¥ä¸Žè¶…æ—¶æŽ§åˆ¶é€‰é¡¹ã€‚
- `config.go` å†…ç½® YAML é…ç½®è§£æžé€»è¾‘ï¼Œå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½å¹¶æ³¨å…¥åˆ°æ¡†æž¶ä¸Šä¸‹æ–‡ã€‚

#### æŸ¥è¯¢æ¡ä»¶ä½¿ç”¨

æŸ¥è¯¢æ¡ä»¶æ”¯æŒå¤šç§æ ¼å¼ï¼Œ**æ‰€æœ‰æ¡ä»¶å€¼å¿…é¡»æ˜¯æ•°ç»„ï¼ˆåˆ‡ç‰‡ï¼‰**ï¼š

**1. é»˜è®¤ AND æ¡ä»¶ï¼ˆä¸å†™åŽç¼€ï¼‰**
```go
// å•ä¸ªæ¡ä»¶
queryConditions := map[string]any{
    "age": []any{18},  // age = 18
}

// å¤šä¸ªæ¡ä»¶ï¼ˆAND è¿žæŽ¥ï¼‰
queryConditions := map[string]any{
    "age": []any{">18", "<=65"},  // age > 18 AND age <= 65
    "status": []any{1},            // status = 1
}
// ç”Ÿæˆçš„ SQL: WHERE age > 18 AND age <= 65 AND status = 1
```

**2. OR æ¡ä»¶**
```go
// ä½¿ç”¨ ::__OR__ åŽç¼€
queryConditions := map[string]any{
    "age::__OR__": []any{18, 20, 25},  // age = 18 OR age = 20 OR age = 25
}

// OR æ¡ä»¶æ”¯æŒæ“ä½œç¬¦
queryConditions := map[string]any{
    "age::__OR__": []any{">30", "<18"},  // age > 30 OR age < 18
}
```

**3. AND æ¡ä»¶ï¼ˆæ˜¾å¼æŒ‡å®šï¼‰**
```go
// ä½¿ç”¨ ::__AND__ åŽç¼€ï¼ˆä¸Žé»˜è®¤è¡Œä¸ºç›¸åŒï¼Œä½†æ›´æ˜Žç¡®ï¼‰
queryConditions := map[string]any{
    "age::__AND__": []any{">18", "<=65"},  // age > 18 AND age <= 65
}
```

**4. IN æ¡ä»¶**
```go
// ä½¿ç”¨ ::__IN__ åŽç¼€
queryConditions := map[string]any{
    "status::__IN__": []any{1, 2, 3},  // status IN (1, 2, 3)
}
```

**5. æ”¯æŒçš„æ“ä½œç¬¦**
- æ¯”è¾ƒæ“ä½œç¬¦ï¼š`=`, `!=`, `<>`, `>`, `>=`, `<`, `<=`
- æ¨¡ç³ŠæŸ¥è¯¢ï¼šå€¼ä¸­åŒ…å« `%` æ—¶è‡ªåŠ¨ä½¿ç”¨ `LIKE`
- ç©ºå€¼æŸ¥è¯¢ï¼š`=__EMPTY__`ï¼ˆæŸ¥è¯¢ NULL æˆ–ç©ºå­—ç¬¦ä¸²ï¼‰ï¼Œ`!=__EMPTY__`ï¼ˆæŸ¥è¯¢éžç©ºï¼‰

**6. æ··åˆä½¿ç”¨ç¤ºä¾‹**
```go
queryConditions := map[string]any{
    // é»˜è®¤ AND æ¡ä»¶
    "status": []any{1},
    "age": []any{">18", "<=65"},  // age > 18 AND age <= 65
    
    // OR æ¡ä»¶
    "city::__OR__": []any{"åŒ—äº¬", "ä¸Šæµ·", "å¹¿å·ž"},
    
    // IN æ¡ä»¶
    "type::__IN__": []any{1, 2, 3},
}
// ç”Ÿæˆçš„ SQL: WHERE status = 1 AND age > 18 AND age <= 65 
//           AND (city = 'åŒ—äº¬' OR city = 'ä¸Šæµ·' OR city = 'å¹¿å·ž')
//           AND type IN (1, 2, 3)
```

**æ³¨æ„äº‹é¡¹ï¼š**
- æ‰€æœ‰æ¡ä»¶å€¼å¿…é¡»æ˜¯æ•°ç»„æˆ–åˆ‡ç‰‡ï¼Œå³ä½¿æ˜¯å•ä¸ªæ¡ä»¶ä¹Ÿè¦å†™æˆæ•°ç»„
- å­—æ®µåä¼šè‡ªåŠ¨è½¬æ¢ä¸º snake_case æ ¼å¼
- å¤šä¸ªå­—æ®µä¹‹é—´é»˜è®¤æ˜¯ AND å…³ç³»
- åŒä¸€å­—æ®µçš„å¤šä¸ªæ¡ä»¶ä¼šæ ¹æ®åŽç¼€ç±»åž‹è¿›è¡Œ OR æˆ– AND è¿žæŽ¥

### æ—¥å¿—ç³»ç»Ÿ
- `logger` æ¨¡å—åŽŸç”Ÿæ”¯æŒå½©è‰²è¾“å‡ºã€æ–‡ä»¶ä¿å­˜ã€æœ€å¤§æ–‡ä»¶å¤§å°ã€æœ€å¤§ä¿å­˜å¤©æ•°ä¸Žè‡ªåŠ¨åˆ é™¤ç­–ç•¥ã€‚
- ä¸Žæ¡†æž¶æ·±åº¦é›†æˆï¼šåˆå§‹åŒ–é˜¶æ®µæ ¹æ®é…ç½®è‡ªåŠ¨å¼€å¯æˆ–å…³é—­ç›¸å…³åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æž„
```
gostar/
â”œâ”€â”€ gostar.go          # æ¡†æž¶å…¥å£ä¸Žç”Ÿå‘½å‘¨æœŸæŽ§åˆ¶
â”œâ”€â”€ config.go          # é…ç½®è§£æžå¤„ç†
â”œâ”€â”€ router/            # è·¯ç”±ç³»ç»Ÿ
â”‚   â”œâ”€â”€ router.go      # Router å®žçŽ°
â”‚   â”œâ”€â”€ route.go       # è·¯ç”±é…ç½®ç»“æž„
â”‚   â”œâ”€â”€ path.go        # è·¯å¾„è§£æžä¸Žå‚æ•°æå–
â”‚   â”œâ”€â”€ handler/       # è¯·æ±‚å¤„ç†ã€å“åº”å°è£…ã€é™æ€/WS/WebApp æ”¯æŒ
â”‚   â””â”€â”€ middleware/    # æ¡†æž¶å†…ç½®ä¸­é—´ä»¶
â”œâ”€â”€ model/             # æ•°æ®åº“ / Redis æ”¯æŒ
â”œâ”€â”€ logger/            # æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ utils/             # é€šç”¨å·¥å…·å‡½æ•°ä¸Žè¾…åŠ©æ–¹æ³•
â””â”€â”€ demo/              # ç¤ºä¾‹ç¨‹åº
```

## ç³»ç»Ÿè¦æ±‚
- Go 1.25.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

## ä¾èµ–
- `gorm.io/gorm`
- `go.mongodb.org/mongo-driver`
- `github.com/go-redis/redis`
- `github.com/gorilla/websocket`
- `gopkg.in/yaml.v3`

## è®¸å¯è¯
é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è´¡çŒ®
æ¬¢è¿Žæäº¤ Issue ä¸Ž Pull Requestï¼
